CREATE DATABASE PHANMEM

use PHANMEM
CREATE TABLE QUANLYDOCGIA(
	MADOCGIA NVARCHAR(20) NOT NULL primary key,
	TEN NVARCHAR(20),
	GIOITINH NVARCHAR(20),
	NGAYSINH DATE,
	DIACHI NVARCHAR(20),
	SDT NVARCHAR(20),
	EMAIL NVARCHAR(40),
)
CREATE TABLE QUANLYTHUTHU(
	MATHUTHU NVARCHAR(20) NOT NULL primary key,
	TEN NVARCHAR(20),
	GIOITINH NVARCHAR(20),
	NGAYSINH DATE,
	DIACHI NVARCHAR(20),
	SDT NVARCHAR(20),
	EMAIL NVARCHAR(20),
)
create table QUANLYSACH(
	MASACH NVARCHAR(20) NOT NULL primary key,
	TENSACH nvarchar(20) NOT NULL,
	LOAISACH nvarchar(20),
	NXB Nvarchar(20),
	GIA FLOAT,
	TENTACGIA Nvarchar(20),	
)
create table PHIEUMUON(
	MAPM NVARCHAR(20) NOT NULL primary key,
	MADOCGIA NVARCHAR(20),
	MASACH NVARCHAR(20),
	MATHUTHU NVARCHAR(20),
	TTXL nvarchar(20),
	NGAYMUON DATE,
	NGAYHENTRA DATE,
	TRANGTHAI Nvarchar(20),	
	foreign key(MADOCGIA) references QUANLYDOCGIA(MADOCGIA),
	foreign key(MASACH) references QUANLYSACH(MASACH),
	foreign key(MATHUTHU) references QUANLYTHUTHU(MATHUTHU),
)
create table PHIEUTRA(
	MAPT NVARCHAR(20) NOT NULL primary key,
	MAPM NVARCHAR(20),
	MADOCGIA NVARCHAR(20),
	MATHUTHU NVARCHAR(20),
	MASACH NVARCHAR(20),
	TTXL nvarchar(20),
	NGAYTRA DATE,
	PHITREHAN FLOAT,	
	foreign key(MADOCGIA) references QUANLYDOCGIA(MADOCGIA),
	foreign key(MASACH) references QUANLYSACH(MASACH),
	foreign key(MAPM) references PHIEUMUON(MAPM),
	foreign key(MATHUTHU) references QUANLYTHUTHU(MATHUTHU),
)
INSERT INTO QUANLYDOCGIA(MADOCGIA,TEN,GIOITINH,NGAYSINH,DIACHI,SDT,EMAIL)
VALUES	(N'DG001',N'Phạm Tuấn Vũ',N'Nam','2003-01-14',N'Hải Dương','0833190783','vu@gmail.com'),
		(N'DG002',N'Võ Quốc Việt',N'Nam','2003-03-04',N'Nghệ An','0367020403','viet@gmail.com'),
		(N'DG003',N'PHẠM TRẦN ANH',N'Nam','2003-08-06',N'Hà Nội','123456789','anh@gmail.com'),
		(N'DG004',N'TRẦN HÀ ĐĂNG',N'Nam','2003-12-29',N'Hải Phòng','987654321','dang@gmail.com'),
		(N'DG005',N'PHẠM TIẾN DUY',N'Nam','2003-09-27',N'Hà Tĩnh','3444445555','pduy@gmail.com'),
		(N'DG006',N'LÊ THỊ GIANG',N'Nữ','2003-04-01',N'Thanh Hóa','8888777733','thigiang@gmail.com'),
		(N'DG007',N'PHẠM HƯƠNG GIANG',N'Nữ','2003-08-03',N'Lào Cai','8777666655','huonggiang@gmail.com'),
		(N'DG008',N'TRỊNH THỊ GIANG',N'Nữ','2003-10-27',N'Cà Mau','3333344444','trinhgiang@gmail.com'),
		(N'DG009',N'PHẠM HỒNG HẠNH',N'Nữ','2003-09-11',N'Thái Nguyên','7883775533','hanh@gmail.com'),
		(N'DG010',N'MAI PHI HIẾU',N'Nam','2003-06-11',N'Thanh Hóa','7785993745','hieu@gmail.com');

INSERT INTO QUANLYTHUTHU(MATHUTHU,TEN,GIOITINH,NGAYSINH,DIACHI,SDT,EMAIL)
VALUES	(N'TT001',N'Phạm Tuấn Vũ',N'Nam','2003-01-14',N'Hải Dương','0833190783','vu@gmail.com'),
		(N'TT002',N'Võ Quốc Việt',N'Nam','2003-03-04',N'Nghệ An','0367020403','viet@gmail.com'),
		(N'TT003',N'PHẠM TRẦN ANH',N'Nam','2003-08-06',N'Hà Nội','123456789','anh@gmail.com');


INSERT INTO QUANLYSACH (MASACH, TENSACH, LOAISACH, NXB, GIA, TENTACGIA)
VALUES
  (N'S001', N'Lập Trình Python', N'Sách Kỹ Thuật', N'NXB Giáo Dục', 120.5, N'Nguyễn Văn A'),
  (N'S002', N'Đắc Nhân Tâm', N'Sách Tự Phát Triển', N'NXB Trẻ', 75.0, N'Nguyễn Văn B'), 
  (N'S003', N'Tôi Thấy ', N'Tiểu Thuyết', N'NXB Hội Nhà Văn', 90.8, N'Nguyễn Nhật Ánh'),
  (N'S004', N'Tuổi Trẻ ', N'Sách Tự Phát Triển', N'NXB Trẻ', 85.0, N'Rosie Nguyễn'),
  (N'S005', N'Hạnh Phúc ', N'Sách Tâm Lý', N'NXB Phụ Nữ', 68.0, N'Thích Nhất Hạnh'),
  (N'S006', N'Chiến Tranh', N'Tiểu Thuyết Lịch Sử', N'NXB Kim Đồng', 120.0, N'Lev Tolstoy'),
  (N'S007', N'Một Đời Sống', N'Tiểu Thuyết', N'NXB Hội Nhà Văn', 95.0, N'Dostoevsky'), 
  (N'S008', N'Số Đỏ', N'Tiểu Thuyết Xã Hội', N'NXB Văn Học', 80.0, N'Vũ Trọng Phụng'),
  (N'S009', N'Hoàng Tử Bé', N'Sách Thiếu Nhi', N'NXB Trẻ', 50.0, N'Antoine de '),
  (N'S010', N'Tôi Là Ai', N'Sách Tâm Lý', N'NXB Hồng Đức', 60.0, N'Thích Nhất Hạnh');

INSERT INTO PHIEUMUON (MAPM, MADOCGIA, MASACH, MATHUTHU, TTXL, NGAYMUON, NGAYHENTRA, TRANGTHAI)
VALUES
  ('PM001', 'DG001', 'S001', 'TT001', N'Đang xử lý', '2023-09-01', '2023-09-15', N'Đã trả'),
  ('PM002', 'DG002', 'S002', 'TT002', N'Đang xử lý', '2023-10-01', '2023-10-15', N'Đã trả'),
  ('PM003', 'DG003', 'S003', 'TT003', N'Đang xử lý', '2023-11-01', '2023-11-30', N'Đã trả'),
  ('PM004', 'DG004', 'S004', 'TT001', N'Đang xử lý', '2023-12-01', NULL, N'Đang mượn'),
  ('PM005', 'DG005', 'S005', 'TT002', N'Đang xử lý', '2024-01-01', NULL, N'Đang mượn'),
  ('PM006', 'DG006', 'S006', 'TT003', N'Đang xử lý', '2024-02-01', '2024-02-15', N'Đã trả'),
  ('PM007', 'DG007', 'S007', 'TT001', N'Đang xử lý', '2024-03-01', NULL, N'Đang mượn'),
  ('PM008', 'DG008', 'S008', 'TT002', N'Đang xử lý', '2024-04-01', NULL, N'Đang mượn'),
  ('PM009', 'DG009', 'S009', 'TT003', N'Đang xử lý', '2024-05-01', NULL, N'Đang mượn'),
  ('PM010', 'DG010', 'S010', 'TT001', N'Đang xử lý', '2024-06-01', NULL, N'Đang mượn');

INSERT INTO PHIEUTRA (MAPT, MAPM, MADOCGIA, MATHUTHU, MASACH, TTXL, NGAYTRA, PHITREHAN)
VALUES
    ('PT001', 'PM001', 'DG001', 'TT001', 'S001', N'Đã hoàn trả', '2023-04-01', 0.0),
    ('PT002', 'PM002', 'DG002', 'TT002', 'S002', N'Đã hoàn trả', '2023-04-05', 5.0),
    ('PT003', 'PM003', 'DG003', 'TT001', 'S003', N'Đã hoàn trả', '2023-04-10', 0.0),
    ('PT004', 'PM004', 'DG004', 'TT002', 'S004', N'Đã hoàn trả', '2023-04-15', 0.0),
    ('PT005', 'PM005', 'DG005', 'TT001', 'S005', N'Đang xử lý', '2023-04-20', 10.0),
    ('PT006', 'PM006', 'DG006', 'TT002', 'S006', N'Đã hoàn trả', '2023-04-25', 0.0),
    ('PT007', 'PM007', 'DG007', 'TT001', 'S007', N'Đã hoàn trả', '2023-05-01', 0.0),
    ('PT008', 'PM008', 'DG008', 'TT002', 'S008', N'Đang xử lý', '2023-05-05', 7.5),
    ('PT009', 'PM009', 'DG009', 'TT001', 'S009', N'Đã hoàn trả', '2023-05-10', 0.0),
    ('PT010', 'PM010', 'DG010', 'TT002', 'S010', N'Đã hoàn trả', '2023-05-15', 0.0);

select * from QUANLYDOCGIA
select * from QUANLYTHUTHU
select * from QUANLYSACH
SELECT
    PHIEUMUON.MAPM,
    QUANLYDOCGIA.MADOCGIA,
    QUANLYSACH.MASACH,
	QUANLYTHUTHU.MATHUTHU,
    QUANLYSACH.TENSACH,
    QUANLYSACH.TENTACGIA,
    QUANLYSACH.NXB,
    QUANLYSACH.GIA,
    PHIEUMUON.NGAYMUON,
    PHIEUMUON.NGAYHENTRA,
    PHIEUMUON.TRANGTHAI
FROM PHIEUMUON
INNER JOIN QUANLYSACH ON PHIEUMUON.MASACH = QUANLYSACH.MASACH
INNER JOIN QUANLYTHUTHU ON PHIEUMUON.MATHUTHU = QUANLYTHUTHU.MATHUTHU
INNER JOIN QUANLYDOCGIA ON PHIEUMUON.MADOCGIA = QUANLYDOCGIA.MADOCGIA
WHERE PHIEUMUON.TRANGTHAI = N'Đang mượn';

SELECT 
    PHIEUTRA.MAPT,
    PHIEUMUON.MAPM,
    QUANLYDOCGIA.MADOCGIA, 
    QUANLYDOCGIA.TEN,
    QUANLYTHUTHU.MATHUTHU,
    QUANLYTHUTHU.TEN,
    QUANLYSACH.MASACH,
    QUANLYSACH.TENSACH,
    PHIEUTRA.TTXL,
    PHIEUTRA.NGAYTRA,
    PHIEUTRA.PHITREHAN
FROM PHIEUTRA 
INNER JOIN QUANLYDOCGIA  ON PHIEUTRA.MADOCGIA = QUANLYDOCGIA.MADOCGIA
INNER JOIN QUANLYTHUTHU  ON PHIEUTRA.MATHUTHU = QUANLYTHUTHU.MATHUTHU  
INNER JOIN QUANLYSACH  ON PHIEUTRA.MASACH = QUANLYSACH.MASACH
INNER JOIN PHIEUMUON ON PHIEUTRA.MAPM = PHIEUMUON.MAPM
WHERE PHIEUTRA.TTXL = N'Đang xử lý'


DELETE FROM QUANLYDOCGIA